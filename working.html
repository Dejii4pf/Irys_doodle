<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Irys Doodle</title>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f0f0f0;
    }
    h1 {
      margin: 20px;
      font-size: 2rem;
      text-align: center;
    }
    #toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    canvas {
      border: 1px solid #ccc;
      background-color: white;
    }
    .sticky-note {
      position: absolute;
      background: yellow;
      padding: 10px;
      font-size: 14px;
      resize: both;
      overflow: auto;
    }
    .material-symbols-outlined {
      font-size: 24px;
      vertical-align: middle;
    }
    button.icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }
  </style>
</head>
<body>
  <h1>Irys Doodle</h1>
  <div id="toolbar">
    <button class="icon-btn" onclick="setTool('pen')" title="Pen"><span class="material-symbols-outlined">edit</span></button>
    <button class="icon-btn" onclick="setTool('brush')" title="Brush"><span class="material-symbols-outlined">brush</span></button>
    <button class="icon-btn" onclick="setTool('eraser')" title="Eraser"><span class="material-symbols-outlined">ink_eraser</span></button>
    <button class="icon-btn" onclick="setTool('rect')" title="Rectangle"><span class="material-symbols-outlined">rectangle</span></button>
    <button class="icon-btn" onclick="setTool('circle')" title="Circle"><span class="material-symbols-outlined">circle</span></button>
    <button class="icon-btn" onclick="addStickyNote()" title="Add Sticky Note"><span class="material-symbols-outlined">sticky_note_2</span></button>
    <input type="color" id="colorPicker" value="#000000" onchange="changeColor()">
    <input type="color" id="bgColorPicker" value="#ffffff" onchange="changeBackground()">
    <input type="range" id="sizeSlider" min="1" max="50" value="5" title="Tool Size">
    <input type="file" id="uploadFile" onchange="uploadImage(event)" />
    <button onclick="clearCanvasAndNotes()">Clear All</button>
    <button onclick="saveCanvas()">Save</button>
  </div>
  <canvas id="canvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const sizeSlider = document.getElementById("sizeSlider");
    let drawing = false;
    let tool = "pen";
    let color = document.getElementById("colorPicker").value;
    let bgColor = document.getElementById("bgColorPicker").value;
    let startX, startY;
    let savedImageData;

    function setTool(t) {
      tool = t;
    }

    function changeColor() {
      color = document.getElementById("colorPicker").value;
      ctx.strokeStyle = color;
      ctx.fillStyle = color;
    }

    function changeBackground() {
      bgColor = document.getElementById("bgColorPicker").value;
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.putImageData(imgData, 0, 0);
    }

    canvas.addEventListener("mousedown", (e) => {
      drawing = true;
      startX = e.offsetX;
      startY = e.offsetY;
      savedImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      if (["pen", "brush", "eraser"].includes(tool)) {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
      }
    });

    canvas.addEventListener("mousemove", (e) => {
      if (!drawing) return;
      const x = e.offsetX;
      const y = e.offsetY;

      const size = parseInt(sizeSlider.value);

      if (tool === "pen") {
        ctx.lineWidth = size;
        ctx.strokeStyle = color;
        ctx.lineTo(x, y);
        ctx.stroke();
      } else if (tool === "brush") {
        ctx.lineWidth = size * 2;
        ctx.strokeStyle = color;
        ctx.lineTo(x, y);
        ctx.stroke();
      } else if (tool === "eraser") {
        ctx.lineWidth = size * 2;
        ctx.strokeStyle = bgColor;
        ctx.lineTo(x, y);
        ctx.stroke();
      } else if (tool === "rect" || tool === "circle") {
        ctx.putImageData(savedImageData, 0, 0);
        drawPreviewShape(x, y);
      }
    });

    canvas.addEventListener("mouseup", (e) => {
      drawing = false;
      const x = e.offsetX;
      const y = e.offsetY;

      if (tool === "rect") {
        ctx.strokeStyle = color;
        ctx.lineWidth = parseInt(sizeSlider.value);
        ctx.strokeRect(startX, startY, x - startX, y - startY);
      } else if (tool === "circle") {
        ctx.strokeStyle = color;
        ctx.lineWidth = parseInt(sizeSlider.value);
        const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
        ctx.beginPath();
        ctx.arc(startX, startY, radius, 0, Math.PI * 2);
        ctx.stroke();
      }
    });

    function drawPreviewShape(x, y) {
      ctx.beginPath();
      ctx.strokeStyle = color;
      ctx.lineWidth = parseInt(sizeSlider.value);
      if (tool === "rect") {
        ctx.strokeRect(startX, startY, x - startX, y - startY);
      } else if (tool === "circle") {
        const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
        ctx.arc(startX, startY, radius, 0, Math.PI * 2);
        ctx.stroke();
      }
    }

    function addStickyNote() {
      const note = document.createElement("textarea");
      note.className = "sticky-note";
      note.style.left = "100px";
      note.style.top = "100px";
      note.setAttribute("contenteditable", true);
      note.style.position = "absolute";
      document.body.appendChild(note);

      note.addEventListener("mousedown", (e) => {
        let offsetX = e.offsetX;
        let offsetY = e.offsetY;

        function mouseMoveHandler(e) {
          note.style.left = e.pageX - offsetX + "px";
          note.style.top = e.pageY - offsetY + "px";
        }

        function mouseUpHandler() {
          document.removeEventListener("mousemove", mouseMoveHandler);
          document.removeEventListener("mouseup", mouseUpHandler);
        }

        document.addEventListener("mousemove", mouseMoveHandler);
        document.addEventListener("mouseup", mouseUpHandler);
      });
    }

    function uploadImage(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function (evt) {
        const img = new Image();
        img.onload = function () {
          ctx.drawImage(img, 0, 0);
        };
        img.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    }

    function saveCanvas() {
      const link = document.createElement("a");
      link.download = "irys_doodle.png";
      link.href = canvas.toDataURL();
      link.click();
    }

    function clearCanvasAndNotes() {
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      document.querySelectorAll('.sticky-note').forEach(note => note.remove());
    }

    // Initialize background color
    changeBackground();
  </script>
</body>
</html>
